
SUGAR.util.doWhen(function(){return $('#applied_fields_col')[0]!=null&&$('#available_fields_col')[0]!=null;},function(){initAppliedFieldsWidget();initAvailableFieldsWidget();});$(function(){$('#target_module').bind('focus, click',function(){$(this).attr('cur-data',$(this).val());});$('#target_module').change(function(e){var targetModule=$(this).val();var appliedFields=getAppliedFields();if(appliedFields.length>0){if(confirm(SUGAR.language.get('C_DuplicationDetection','LBL_TARGET_MODULE_CHANGE_CONFIRM_MSG'))){ajaxLoadAvailableFields(targetModule);}else{var curValue=$(this).attr('cur-data');$(this).val(curValue);}}else{ajaxLoadAvailableFields(targetModule);}});$('.action_buttons').find('.button.primary').each(function(){var curClickLogic=$(this).attr('onclick');$(this).attr('onclick','SUGAR.saveAppliedFields(); '+curClickLogic);});});function ajaxLoadAvailableFields(moduleName){$.ajax({'url':'index.php?module=C_DuplicationDetection&action=ajaxloadavailablefields&sugar_body_only=true','type':'POST','dataType':'json','data':{'moduleName':moduleName},'success':function(fields){console.log(fields);SUGAR.appliedFieldsWidget.deleteRows(0,SUGAR.appliedFieldsWidget.getRecordSet().getLength());SUGAR.appliedFieldsWidget.addRow({field_name:"",label:""});SUGAR.appliedFieldsWidget.render();SUGAR.availableFieldsWidget.deleteRows(0,SUGAR.availableFieldsWidget.getRecordSet().getLength());SUGAR.availableFieldsWidget.addRows(fields);}});}
function initAppliedFieldsWidget(){SUGAR.appliedFieldsWidget=new YAHOO.SUGAR.DragDropTable('applied_fields_col',[{key:"label",label:lblAppliedFields,width:200,sortable:false},{key:"field_name",label:lblAppliedFields,hidden:true}],new YAHOO.util.LocalDataSource(appliedFields,{responseSchema:{resultsList:"fields",fields:[{key:"field_name"},{key:"label"}]}}),{height:"300px",group:["applied_fields_col","available_fields_col"]});SUGAR.appliedFieldsWidget.disableEmptyRows=true;SUGAR.appliedFieldsWidget.addRow({field_name:"",label:""});SUGAR.appliedFieldsWidget.render();}
function initAvailableFieldsWidget(){SUGAR.availableFieldsWidget=new YAHOO.SUGAR.DragDropTable('available_fields_col',[{key:"label",label:lblAvailableFields,width:200,sortable:false},{key:"field_name",label:lblAvailableFields,hidden:true}],new YAHOO.util.LocalDataSource(availableFields,{responseSchema:{resultsList:"fields",fields:[{key:"field_name"},{key:"label"}]}}),{height:"300px",group:["applied_fields_col","available_fields_col"]});SUGAR.availableFieldsWidget.disableEmptyRows=true;SUGAR.availableFieldsWidget.addRow({field_name:"",label:""});SUGAR.availableFieldsWidget.render();}
function getAppliedFields(){var appliedFieldsSet=SUGAR.appliedFieldsWidget.getRecordSet();var fields=[];for(var i=0;i<appliedFieldsSet.getLength();i++){var data=appliedFieldsSet.getRecord(i).getData();if(data.field_name&&data.field_name!='')
fields[i]=data.field_name;}
return fields;}
SUGAR.saveAppliedFields=function(){var fields=getAppliedFields();var selectedFields='';if(fields.length>0)selectedFields=YAHOO.lang.JSON.stringify(fields);YAHOO.util.Dom.get('target_fields').value=selectedFields;}