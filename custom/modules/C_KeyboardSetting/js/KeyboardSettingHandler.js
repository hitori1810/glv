SUGAR.KeyboardSetting={};SUGAR.KeyboardSetting.config={};$(function(){var quickCreateLinks=$('#quickCreateULSubnav').find('li').find('a');var quickCreateButtons=$('.cardDetails').find('.cardActions').find('button');quickCreateLinks.add(quickCreateButtons).click(function(){SUGAR.util.doWhen(function(){return $('form[id*="form_DCQuickCreate"]')[0]!=null;},function(){var form=$('form[id*="form_DCQuickCreate"]');ajaxLoadKeyboardSetting(form);});});if($('form#EditView')[0]!=null){var form=$('form#EditView');ajaxLoadKeyboardSetting(form);}
if($('#formDetailView')[0]!=null){$('input[id*="create"]').click(function(){SUGAR.util.doWhen(function(){return $('form[id*="form_SubpanelQuickCreate"]')[0]!=null;},function(){var form=$('form[id*="form_SubpanelQuickCreate"]');ajaxLoadKeyboardSetting(form);});});}});function ajaxLoadKeyboardSetting(form){var formId=form.attr('id');if(form.find('input[name="module"]')[0]!=null){var moduleName=form.find('input[name="module"]').val();if(moduleName!=''){$.ajax({'url':'index.php?module=C_KeyboardSetting&action=ajaxloadconfig&sugar_body_only=true','type':'POST','dataType':'json','data':{'moduleName':moduleName},'success':function(config){if(!$.isEmptyObject(config)){SUGAR.KeyboardSetting.config[formId]=config;for(fieldName in config){if(fieldName!='email'){var targetField=form.find(':input[name="'+fieldName+'"]');SUGAR.KeyboardSetting.handleField(targetField);targetField.live('change',function(){SUGAR.KeyboardSetting.handleField($(this));});}}
if(config['email']!=null){var emails=form.find('.emailaddresses');emails.find('input[type="text"][id*="emailAddress"]').each(function(){SUGAR.KeyboardSetting.handleField($(this));});emails.find('button[id*="email_widget_add"]').click(function(){emails.find('input[type="text"][id*="emailAddress"]:last').each(function(){SUGAR.KeyboardSetting.handleField($(this));});});}}}});}}}
SUGAR.KeyboardSetting.handleField=function(targetField){var form=targetField.closest('form');var formConfig=SUGAR.KeyboardSetting.config[form.attr('id')];if(!$.isEmptyObject(formConfig)){var fieldName=(targetField.attr('name').indexOf('emailAddress')>=0)?'email':targetField.attr('name');var fieldConfig=formConfig[fieldName];if(!$.isEmptyObject(formConfig)){var fieldVal=targetField.val();var correctionType=fieldConfig.correction_type;if(correctionType=='uppercase_all'){fieldVal=fieldVal.toUpperCase();targetField.css({'text-transform':'uppercase'});}else if(correctionType=='initial_capital'){fieldVal=fieldVal.toLowerCase().replace(/^[\u00C0-\u1FFF\u2C00-\uD7FF\w]|\s[\u00C0-\u1FFF\u2C00-\uD7FF\w]/g,function(letter){return letter.toUpperCase();});targetField.css({'text-transform':'capitalize'});}else if(correctionType=='first_letter_capital'){if(fieldVal.trim()!=''){fieldVal=fieldVal[0].toUpperCase()+fieldVal.slice(1);}
targetField.keyup(function(){var value=$(this).val();if(value.trim()!=''){value=value[0].toUpperCase()+value.slice(1).toLowerCase();$(this).val(value);}});}else{fieldVal=fieldVal.toLowerCase();targetField.css({'text-transform':'lowercase'});}
targetField.val(fieldVal);}}}