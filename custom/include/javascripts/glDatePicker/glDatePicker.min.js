(function($){var defaults={calId:0,cssName:"default",startDate:-1,endDate:-1,leveaFullDate:new Array,leveaHaftDate:new Array,showPrevNext:true,allowOld:true,showAlways:false,position:"absolute"};var methods={init:function(options){return this.each(function(){var self=$(this);var settings=$.extend({},defaults);settings.calId=self[0].id+"-gldp";if(options)settings=$.extend(settings,options);self.data("settings",settings);self.data("settings").selectedDate=new Array;self.data("settings").leaveDate=new Array;
self.data("settings").leaveHaflDay=new Array;self.data("settings").publicDay=new Array;self.click(methods.show).focus(methods.show);if(settings.showAlways)setTimeout(function(){self.trigger("focus")},50);$(document).bind("click",function(e){methods.hide.apply(self)})})},show:function(e){e.stopPropagation();methods.hide.apply($("._gldp").not($(this)));methods.update.apply($(this))},hide:function(){if($(this).length){var s=$(this).data("settings");if(!s.showAlways){$("#"+s.calId).slideUp(200);$(this).removeClass("_gldp")}}},
setStartDate:function(e){$(this).data("settings").startDate=e},setEndDate:function(e){$(this).data("settings").endDate=e},setSelectedDate:function(e,type){if(!type)type="timesheet";if(type=="timesheet")$(this).data("settings").selectedDate.push(e);else if(type=="leaving")$(this).data("settings").leaveDate.push(e);else if(type=="leave_half_day")$(this).data("settings").leaveHaflDay.push(e);else if(type=="public_day")$(this).data("settings").publicDay.push(e)},update:function(){var target=$(this);var settings=
target.data("settings");var calId=settings.calId;var startDate=settings.startDate;if(settings.startDate==-1){startDate=new Date;startDate.setDate(1)}startDate.setHours(0,0,0,0);var startTime=startDate.getTime();var endDate=new Date(0);if(settings.endDate!=-1){endDate=new Date(settings.endDate);if(/^\d+$/.test(settings.endDate)){endDate=new Date(startDate);endDate.setDate(endDate.getDate()+settings.endDate)}}endDate.setHours(0,0,0,0);var endTime=endDate.getTime();var theDate=target.data("theDate");
theDate=theDate==-1||typeof theDate=="undefined"?startDate:theDate;var firstDate=new Date(theDate);firstDate.setDate(1);var firstTime=firstDate.getTime();var lastDate=new Date(firstDate);lastDate.setMonth(lastDate.getMonth()+1);lastDate.setDate(0);var lastTime=lastDate.getTime();var lastDay=lastDate.getDate();var prevDateLastDay=new Date(firstDate);prevDateLastDay.setDate(0);prevDateLastDay=prevDateLastDay.getDate();var monthNames=["January","February","March","April","May","June","July","August",
"September","October","November","December"];target.data("theDate",theDate);var days="";var num_timesheet_days=0;var num_leaving_days=0;var num_leaving_haft_days=0;var num_public_days=0;for(var y=0,i=0;y<6;y++){var row="";for(var x=0;x<7;x++,i++){var p=prevDateLastDay-firstDate.getDay()+i+1;var n=p-prevDateLastDay;var c=x==0?"sun":x==6?"sat":"day";if(n>=1&&n<=lastDay){var today=new Date;today.setHours(0,0,0,0);var date=new Date(theDate);date.setHours(0,0,0,0);date.setDate(n);var dateTime=date.getTime();
c=today.getTime()==dateTime?"today":c;if(!settings.allowOld)c=dateTime<startTime?"noday":c;if(settings.endDate!=-1)c=dateTime>endTime?"noday":c;var sel_day=settings.selectedDate[num_timesheet_days];var leav_day=settings.leaveDate[num_leaving_days];var leav_hafl_day=settings.leaveHaflDay[num_leaving_haft_days];var public_day=settings.publicDay[num_public_days];if(sel_day!=-1&&sel_day!="undefined"&&today.getTime()!=dateTime)if(checkInArray(date,settings.selectedDate)){c="timesheet";num_timesheet_days++}if(leav_day!=
-1&&leav_day!="undefined"&&today.getTime()!=dateTime)if(checkInArray(date,settings.leaveDate)){c="noday leave_day";num_leaving_days++}if(leav_hafl_day!=-1&&leav_hafl_day!="undefined"&&today.getTime()!=dateTime)if(checkInArray(date,settings.leaveHaflDay)){c="leave_half_day";num_leaving_days++}if(public_day!=-1&&public_day!="undefined"&&today.getTime()!=dateTime)if(checkInArray(date,settings.publicDay)){c="noday public_day";num_public_days++}}else{c="noday";n=n<=0?p:p-lastDay-prevDateLastDay}row+="<td class='gldp-days "+
c+" **-"+c+"'><div class='"+c+"'>"+n+"</div></td>"}days+="<tr class='days'>"+row+"</tr>"}var showP=startTime<firstTime||settings.allowOld;var showN=lastTime<endTime||endTime<startTime;if(!settings.showPrevNext)showP=showN=false;var titleMonthYear=monthNames[theDate.getMonth()]+" "+theDate.getFullYear();var html="<div class='**'>"+"<table>"+"<tr>"+("<td class='**-prevnext prev'>"+(showP?"\u25c4":"")+"</td>")+"<td class='**-monyear' colspan='5'>{MY}</td>"+("<td class='**-prevnext next'>"+(showN?"\u25ba":
"")+"</td>")+"</tr>"+"<tr class='**-dow'>"+"<td>Sun</td><td>Mon</td><td>Tue</td><td>Wed</td><td>Thu</td><td>Fri</td><td>Sat</td>"+"</tr>"+days+"</table>"+"</div>";html=html.replace(/\*{2}/gi,"gldp-"+settings.cssName).replace(/\{MY\}/gi,titleMonthYear);if($("#"+calId).length==0)target.after($("<div id='"+calId+"'></div>").css({"position":settings.position,"z-index":settings.zIndex,"left":target.offset().left,"top":target.offset().top+target.outerHeight(true)}));var calendar=$("#"+calId);calendar.html(html).slideDown(200);
target.addClass("_gldp");$("[class*=-prevnext]",calendar).click(function(e){e.stopPropagation();if($(this).html()!=""){var offset=$(this).hasClass("prev")?-1:1;var newDate=new Date(firstDate);newDate.setMonth(theDate.getMonth()+offset);target.data("theDate",newDate);methods.update.apply(target)}});$("tr.days td:not(.noday)",calendar).mouseenter(function(e){var css="gldp-"+settings.cssName+"-"+$(this).children("div").attr("class");$(this).removeClass(css).addClass(css+"-hover")}).mouseleave(function(e){var css=
"gldp-"+settings.cssName+"-"+$(this).children("div").attr("class");$(this).removeClass(css+"-hover").addClass(css)}).click(function(e){e.stopPropagation();var day=$(this).children("div").html();var settings=target.data("settings");var newDate=new Date(theDate);newDate.setDate(day);target.data("theDate",newDate);target.val(newDate.getMonth()+1+"/"+newDate.getDate()+"/"+newDate.getFullYear());if(settings.onChange!=null&&typeof settings.onChange!="undefined")settings.onChange(target,newDate);methods.hide.apply(target)})}};
$.fn.glDatePicker=function(method){if(methods[method])return methods[method].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof method==="object"||!method)return methods.init.apply(this,arguments);else $.error("Method "+method+" does not exist on jQuery.glDatePicker")}})(jQuery);
function equalTo(date1,date2){date1.setHours(0,0,0,0);date2.setHours(0,0,0,0);if(date1.getDate()==date2.getDate()&&date1.getMonth()==date2.getMonth()&&date1.getFullYear()==date2.getFullYear())return true;return false}function checkInArray(date,array_date){var flag=false;for(var i=0;i<array_date.length;i++)if(equalTo(date,array_date[i])){flag=true;break}return flag};
