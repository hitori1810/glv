/*!
    jQuery Tag This
    Copyright 2014 Dan Gribbin - dangribbin@gmail.com

    Licensed under the MIT license:
    http://www.opensource.org/licenses/mit-license.php

    Hat tip to jQuery Tags Input Plugin by XOXCO, Inc.

*/
!function(a){"use strict";var b,f,c=[],d=[],e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,g=[37,39,8,46];a.fn.tagThis=function(e){var h=jQuery.extend({interactive:!0,defaultText:"type to tag",createTagWith:"/",hideOriginal:!0,noDuplicates:!1,removeWithBackspace:!0,regex:"",maxChars:0,maxTags:0,width:"300px",height:"100px"},e);return this.each(function(){a(this).data("settings",h),h.hideOriginal&&a(this).hide();var b=a(this).attr("id");b&&!d[a(this).attr("id")]||(b=a(this).attr("id","tags"+(new Date).getTime()).attr("id"));var e=jQuery.extend({wrapper:"#tag-this--"+b,realInput:"#"+b,fakeInput:"#"+b+"--tag"},h);d[b]=e.createTagWith,h.callbacks&&(h.callbacks.beforeAddTag||h.callbacks.afterAddTag||h.callbacks.onChange||h.callbacks.afterRemoveTag||h.callbacks.beforeRemoveTag||h.callbacks.errors)&&(c[b]=[],c[b].beforeAddTag=h.callbacks.beforeAddTag,c[b].afterAddTag=h.callbacks.afterAddTag,c[b].afterRemoveTag=h.callbacks.afterRemoveTag,c[b].onChange=h.callbacks.onChange,c[b].beforeRemoveTag=h.callbacks.beforeRemoveTag,c[b].errors=h.callbacks.errors);var i='<div id="tag-this--'+b+'" class="tag-this"><div id="'+b+'--addTag">';if(h.email&&a(this).data("type","email"),h.interactive&&(i=i+'<input id="'+b+'--tag" value="" data-default="'+h.defaultText+'" />'),i+='</div><div class="tag-this--clear"></div></div><div class="tag-this--error"></div>',a(i).insertAfter(this),h.interactive){var j=a(e.fakeInput),k=a(e.realInput);if(f=j.css("width"),j.val(j.attr("data-default")),a(e.wrapper).on("click",e,function(b){a(b.data.fakeInput).focus()}),j.on("focus",e,function(b){var c=a(b.data.fakeInput);c.val()===c.attr("data-default")&&c.val("")}).on("keyup.arrowKeys",function(b){var c=a(this).parent();if(37===b.which&&""===a(this).val()){var d=c.prev(".tag");d&&c.after(d)}else if(39===b.which&&""===a(this).val()){var d=c.next(".tag");d&&c.before(d)}else if(8===b.keyCode&&""===a(this).val()){var e=c.prev(".tag");e&&e.find(".tag-this--remove-tag").trigger("click")}else if(46===b.keyCode&&""===a(this).val()){var e=c.next(".tag");e&&e.find(".tag-this--remove-tag").trigger("click")}}),h.autocompleteSource){var l={source:h.autocompleteSource,select:function(a,b){a.preventDefault(),k.addTag(b.item.value),j.focus()}};if(!jQuery.ui.autocomplete)throw new Error("jQuery-Tag-This is missing the jQuery UI dependecy needed for autocomplete to work. If you don't need autocomplete, don't set the autocompleteSource setting.");j.autocomplete(l)}j.on("blur",e,function(b){var c=a(this).attr("data-default"),d=a(b.data.fakeInput),e=d.val();return""!==d.val()&&d.val()!==c?a(b.data.realInput).addTag(e):d.val(d.attr("data-default")),!1}),j.on("keypress",e,function(b){var c=a(b.data.fakeInput),d=c.val();if(a(this).autosizeInput(c),a.inArray(b.which,b.data.createTagWith)&&!a.inArray(b.which,g)||13===b.which)return b.preventDefault(),a(b.data.realInput).addTag(d),!1}),j.on("keyup",e,function(b){var c=a(b.data.fakeInput);a(this).autosizeInput(c)}),j.on("keydown",function(b){8===b.keyCode&&a(this).removeClass("tag-this--invalid")}),e.noDuplicates&&j.on("keydown",function(b){(8===b.keyCode||String.fromCharCode(b.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,\/]+/))&&a(this).removeClass("tag-this--invalid")})}}),e&&e.width&&e.height&&(b=a("#tag-this--"+this[0].id),a(b).css({width:e.width,height:e.height})),this},a.fn.addTag=function(b){var d=a(this).data("settings");return this.each(function(){var g,h,i,j,e=a(this).attr("id");a("#"+e+"--tag").removeClass("tag-this--invalid");var k=a(this).data("tags");h=k||[],d.callbacks&&c[e]&&c[e].beforeAddTag&&(i=c[e].beforeAddTag,j={context:a(this),tags:h,attemptedInput:b},i.call(this,j));var l=a(this).validateAddTag(b,d,h);if(l.tagIsInvalid)return g=a("#"+e+"--tag"),g.addClass("tag-this--invalid"),g.trigger("focus"),a(this).relayError(e,b,d,h,l.errors),!1;if(b){if(!b.id){var m=a.fn.tagThis.generateUniqueTagId(h);b={id:m,text:b}}a("<span>").addClass("tag").attr("data-id",b.id).append(a("<span>").text(b.text),a("<button>",{title:"Click to remove "+b.text,text:"x",class:"tag-this--remove-tag"}).on("click",function(){return a("#"+e).removeTag(b)})).insertBefore("#"+e+"--addTag"),h.push(b),a("#"+e+"--tag").val(""),a(this).data("tags",h),g=a("#"+e+"--tag"),g.trigger("focus"),a(this).resetInputSize(g),d.callbacks&&c[e]&&c[e].afterAddTag&&(i=c[e].afterAddTag,j={context:a(this),tags:h,addedInput:b},i.call(this,j)),c[e]&&c[e].onChange&&(i=c[e].onChange,j={context:a(this),tags:h,addedInput:b},i.call(this,j))}}),!1},a.fn.validateAddTag=function(b,c,d){var f,e={};if(e.maxTagsReached=!1,e.maxCharsReached=!1,e.failedCustomRegex=!1,e.emailIsInvalid=!1,e.isDuplicate=!1,c.regex&&!c.email&&!b.id){a(this).failedCustomRegex(b,c)&&(f=!0,e.failedCustomRegex=!0)}if(c.email){a(this).emailIsInvalid(b)&&(f=!0,e.emailIsInvalid=!0)}if(c.noDuplicates){!0===a(this).tagExists(c,b)&&(f=!0,e.isDuplicate=!0)}if(c.maxTags&&c.maxTags===d.length&&(f=!0,e.maxTagsReached=!0),c.maxChars>0){var k=!1;k=b.id?b.text.length>c.maxChars:b.length>c.maxChars,k&&(e.maxCharsReached=!0,f=!0)}return{tagIsInvalid:f,errors:e}},a.fn.removeTag=function(b){return this.each(function(){var e,f,g,d=a(this).attr("id");if(c[d]&&c[d].beforeRemoveTag&&(e=c[d].beforeRemoveTag,f={context:a(this),tags:g,inputToBeRemoved:b},e.call(this,f)),g=a(this).data("tags")){if(b.id){a("#tag-this--"+d+' .tag[data-id="'+b.id+'"]').remove();for(var h=0;h<g.length;h++)g[h].id===b.id&&g.splice(h,1)}else{a("#tag-this--"+d+" .tag").each(function(){a(this).find("span").text()===b&&a(this).remove()});for(var i=0;i<g.length;i++)g[i].text===b&&g.splice(i,1)}a(this).data("tags",g),g&&c[d]&&c[d].afterRemoveTag&&(e=c[d].afterRemoveTag,f={context:a(this),tags:g,removedInput:b},e.call(this,f)),c[d]&&c[d].onChange&&(e=c[d].onChange,f={context:a(this),tags:g,removedInput:b},e.call(this,f))}}),!1},a.fn.tagExists=function(b,c){var d=a(this).data("tags");if(!d)return!1;if(b.interactive||!c.id){for(var e=0;e<d.length;e++)if(d[e].text===c)return!0}else if(c.id)for(var f=0;f<d.length;f++)if(d[f].id===c.id)return!0;return!1},a.fn.autosizeInput=function(a){var c,b=a.width();a[0].scrollWidth-b>0&&(c=b+30),a.css("width",c)},a.fn.resetInputSize=function(a){a.css("width",f)},a.fn.emailIsInvalid=function(a){return!e.test(a)},a.fn.failedCustomRegex=function(a,b){return!b.regex.test(a)},a.fn.relayError=function(a,b,d,e,f){if(d.callbacks&&c[a]&&c[a].errors){var g={id:a,attemptedToTag:b,settings:d,tags:e,errors:f};c[a].errors.call(this,g)}},a.fn.clearAllTags=function(){var f,b=a(this).attr("id"),c=a("#tag-this--"+b),d=a("#"+b+"--tag"),e=c.parent().find(".tag-this--invalid");c.find(".tag").remove(),a(this).data("tags",""),e&&(f=e.data("default"),e.removeClass("tag-this--invalid").val(f),e.trigger("blur")),a(this).resetInputSize(d)},a.fn.tagThis.generateUniqueTagId=function(b){for(var c=1,d=7e3,e=Math.floor(Math.random()*(d-c+1))+c,f=0;f<b.length;f++)b[f].id===e&&f<1e3&&a(this).generateUniqueTagId();return e},a.fn.destroy=function(){a(this).next().remove(),a(this).show()},a.tagThisDestroyAll=function(){a(".tag-this").each(function(){a(this).prev().show(),a(this).remove()})}}(jQuery);